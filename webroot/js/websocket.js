define(["require","jquery","autobahn"],function(e){function o(e){var t="; "+document.cookie,n=t.split("; "+e+"=");if(n.length==2)return n.pop().split(";").shift()}function u(){var e=window.location.hostname;return s.ip!="0.0.0.0"&&(e=s.ip),"ws://"+e+":"+s.port+"/ws"}function a(){if(r!=null)return;this.subscribes=[],this.session=null,that=this;var e=new n.Connection({url:u(),realm:"realm1",authmethods:["jwt"],onchallenge:function(t,n,r){return i}});e.onopen=function(e,t){console.log("connected session with ID "+e.id),that.session=e,that.subscribes.forEach(function(t){e.subscribe(t.topic,t.method,{match:"prefix"})})},e.onclose=function(){console.log("disconnected",arguments)},e.open()}var t=e("jquery"),n=e("autobahn"),r=null,i=o("Jwt"),s=JSON.parse(decodeURIComponent(o("Websockets")));return a.prototype.subscribe=function(e){if(typeof e.topic=="undefined"||e.method==="undefined")return;this.session==null?this.subscribes.push(e):this.session.subscribe(e.topic,e.method)},a.getInstance=function(){return r===null&&(r=new a),r},a.getInstance()});