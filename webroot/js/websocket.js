define(["require","autobahn"],function(e){function s(){if(n!=null)return;this.subscribes=[],this.session=null,that=this;var e=new t.Connection({url:"ws://127.0.0.1:9090/ws",realm:"realm1",authmethods:["wampcra"],authid:r,onchallenge:o});e.onopen=function(e,t){console.log("connected session with ID "+e.id),console.log("authenticated using method '"+t.authmethod+"' and provider '"+t.authprovider+"'"),console.log("authenticated with authid '"+t.authid+"' and authrole '"+t.authrole+"'"),that.session=e,that.subscribes.forEach(function(t){e.subscribe(t.topic,t.method)})},e.onclose=function(){console.log("disconnected",arguments)},e.open()}function o(e,n,r){console.log(n,r);if(n==="wampcra"){var s=i;return typeof r.salt!="undefined"&&(s=t.auth_cra.derive_key(i,r.salt)),console.log("authenticating via '"+n+"' and challenge '"+r.challenge+"'"),t.auth_cra.sign(s,r.challenge)}throw"don't know how to authenticate using '"+n+"'"}var t=e("autobahn"),n=null,r="1",i="phil.laf@gmail.com";return s.prototype.subscribe=function(e){this.session==null?this.subscribes.push(e):this.session.subscribe(e.topic,e.method)},s.getInstance=function(){return n===null&&(n=new s),n},s.getInstance()});